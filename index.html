<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="google-site-verification" content="99zs3GZ15vMYI_xtfo1W8S6U02dZfCELzHo_PFGam10" /> 
  
  <meta charset="UTF-8" />
  <title>Whiskey Tobacco Firearms (WTF) ‚Äî Member Discounts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Primary SEO description -->
  <meta
    name="description"
    content="Whiskey Tobacco Firearms (WTF) is a Veteran-Owned membership program offering exclusive savings on cigars, bourbon, whiskey, firearms, accessories, training courses, and shooting ranges. Proudly supporting veterans, first responders, and healthcare workers. Currently a small local Miami-based business growing toward nationwide coverage."
  />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #0b0d10;           /* lighter, charcoal base */
      color: #f5f5f5;
      line-height: 1.6;
    }
    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; }

    .page-root { min-height: 100vh; display: flex; flex-direction: column; }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 1.5rem; }

    header {
      border-bottom: 1px solid rgba(255,255,255,0.06);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(12px);
      background: linear-gradient(
        90deg,
        rgba(11,13,16,0.96),
        rgba(18,20,26,0.96)
      );
    }
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 0;
    }
    .nav-left {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }
    .logo-icon {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: 2px solid #c58b3a;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.9rem;
      letter-spacing: 0.08em;
      background: radial-gradient(circle at 20% 0%, #30343f, #11141b);
      color: #fdf8ee;
    }
    .logo-text {
      display: flex;
      flex-direction: column;
      font-size: 0.8rem;
      text-transform: uppercase;
    }
    .logo-text span:first-child {
      font-weight: 600;
      letter-spacing: 0.12em;
    }
    .logo-text span:last-child {
      font-size: 0.7rem;
      opacity: 0.7;
      letter-spacing: 0.12em;
    }

    .nav-links {
      display: flex;
      gap: 1.2rem;
      font-size: 0.88rem;
    }
    .nav-links button {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      opacity: 0.75;
    }
    .nav-links button:hover { opacity: 1; }
    .nav-links button.active {
      opacity: 1;
      border-bottom: 2px solid #c58b3a;
      padding-bottom: 0.1rem;
    }

    .nav-cta {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }
    .nav-user {
      font-size: 0.78rem;
      color: rgba(245,245,245,0.7);
      max-width: 160px;
      text-align: right;
    }

    .btn {
      border-radius: 999px;
      padding: 0.5rem 1.1rem;
      font-size: 0.9rem;
      border: 1px solid transparent;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      white-space: nowrap;
    }
    .btn-outline {
      border-color: rgba(255,255,255,0.35);
      background: rgba(16,18,24,0.9);
      color: #f5f5f5;
    }
    .btn-primary {
      border-color: #c58b3a;
      background: linear-gradient(120deg, #f0c36b, #c58b3a, #8c5a19);
      color: #050608;
      font-weight: 600;
    }
    .btn-outline:hover { border-color: #c58b3a; background:#161923; }
    .btn-primary:hover { filter: brightness(1.05); }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .hero { padding: 3rem 0 2.4rem; }
    .hero-inner {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 2.4rem;
      align-items: center;
    }
    .eyebrow {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #c58b3a;
      margin-bottom: 0.4rem;
    }
    .hero-title {
      font-size: clamp(2rem, 3vw, 2.6rem);
      margin-bottom: 0.9rem;
    }
    .hero-title span.highlight {
      color: #f0c36b;
    }
    .hero-text {
      font-size: 0.98rem;
      max-width: 34rem;
      color: rgba(245,245,245,0.88);
      margin-bottom: 1.4rem;
    }
    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-bottom: 1rem;
    }
    .hero-note {
      font-size: 0.78rem;
      color: rgba(245,245,245,0.7);
      max-width: 34rem;
    }
    .hero-note strong { color: #f8e3c0; }

    /* patriotic / service strip */
    .service-strip {
      margin-top: 1.6rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .service-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      border: 1px solid rgba(255,255,255,0.22);
      background: radial-gradient(circle at 0 0, #262a34, #151821);
      color: rgba(247,247,247,0.9);
    }
    .service-pill span.emoji {
      font-size: 0.85rem;
    }

    .hero-card {
      border-radius: 1.1rem;
      padding: 1.6rem;
      border: 1px solid rgba(255,255,255,0.12);
      background:
        radial-gradient(circle at 0 0, rgba(197,139,58,0.18), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(75,114,170,0.28), transparent 55%),
        linear-gradient(145deg, #181b24, #10131b);
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
      font-size: 0.85rem;
    }
    .hero-card h2 {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 0.8rem;
      opacity: 0.9;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
      margin-bottom: 0.9rem;
    }
    .pill {
      border-radius: 999px;
      padding: 0.28rem 0.7rem;
      font-size: 0.7rem;
      background: rgba(11,13,16,0.95);
      border: 1px solid rgba(255,255,255,0.16);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.9;
    }
    .hero-card ul { list-style: none; margin: 0.4rem 0 0.9rem; padding: 0; }
    .hero-card li {
      margin-bottom: 0.4rem;
      display: flex;
      gap: 0.4rem;
      align-items: flex-start;
    }
    .hero-card li span.bullet {
      font-size: 0.9rem;
      color: #c58b3a;
      margin-top: 0.05rem;
    }
    .hero-card-footer {
      font-size: 0.72rem;
      color: rgba(245,245,245,0.8);
      border-top: 1px dashed rgba(255,255,255,0.2);
      padding-top: 0.7rem;
    }

    section.section {
      padding: 2.4rem 0;
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    .section-title {
      font-size: 1.05rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      margin-bottom: 1.4rem;
      color: rgba(245,245,245,0.9);
    }
    .section-subtitle {
      font-size: 0.9rem;
      color: rgba(245,245,245,0.86);
      max-width: 40rem;
      margin-bottom: 1rem;
    }
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1.4rem;
    }

    /* Offers list */
    .offers-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.2rem;
      margin-top: 1rem;
    }
    .offer-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.4rem;
      gap: 0.6rem;
    }
    .offer-vendor {
      font-size: 0.82rem;
      color: rgba(245,245,245,0.78);
    }
    .offer-badge {
      font-size: 0.75rem;
      padding: 0.18rem 0.55rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      white-space: nowrap;
    }
    .offer-footer {
      margin-top: 0.55rem;
      font-size: 0.76rem;
      color: rgba(245,245,245,0.75);
    }

    /* Vendors directory */
    .vendors-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.2rem;
      margin-top: 1rem;
    }
    .vendor-meta {
      font-size: 0.8rem;
      color: rgba(245,245,245,0.8);
      margin-top: 0.1rem;
    }
    .vendor-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.45rem;
    }
    .vendor-tag {
      font-size: 0.72rem;
      padding: 0.16rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.22);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      opacity: 0.9;
    }
    .vendor-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.8rem;
      align-items: center;
      font-size: 0.8rem;
    }
    .vendor-filters select {
      padding: 0.3rem 0.6rem;
      border-radius: 0.4rem;
      border: 1px solid rgba(255,255,255,0.3);
      background: #10131a;
      color: #f5f5f5;
      font-size: 0.8rem;
    }

    .card {
      border-radius: 1rem;
      padding: 1.1rem;
      border: 1px solid rgba(255,255,255,0.12);
      background:
        radial-gradient(circle at 0 0, rgba(197,139,58,0.12), transparent 55%),
        linear-gradient(145deg,#181b24,#10131b);
      font-size: 0.86rem;
    }
    .card h4 { font-size: 0.9rem; margin-bottom: 0.4rem; }
    .card p {
      font-size: 0.83rem;
      color: rgba(245,245,245,0.86);
    }
    .card small {
      display: block;
      margin-top: 0.4rem;
      font-size: 0.74rem;
      color: rgba(245,245,245,0.75);
    }

    .two-col {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 2rem;
      align-items: flex-start;
      font-size: 0.86rem;
    }
    .two-col p {
      color: rgba(245,245,245,0.88);
      margin-bottom: 0.7rem;
    }
    .two-col ul { padding-left: 1rem; margin-top: 0.5rem; }
    .two-col li { margin-bottom: 0.4rem; }
    .policy-box {
      border-radius: 0.9rem;
      border: 1px solid rgba(255,255,255,0.16);
      padding: 1rem;
      background: linear-gradient(145deg,#141822,#0d1018);
      font-size: 0.8rem;
    }
    .policy-box strong { color: #f8e3c0; }

    .view { display: none; }
    .view-active { display: block; }

    .sub-hero { padding: 2.5rem 0 1.2rem; }
    .sub-hero h1 { font-size: 1.8rem; margin-bottom: 0.4rem; }
    .sub-hero p {
      max-width: 40rem;
      color: rgba(245,245,245,0.88);
    }

    .sub-content { padding-bottom: 2.5rem; }

    .voucher-panel {
      margin-top: 1.4rem;
      border-radius: 1rem;
      border: 1px solid rgba(255,255,255,0.18);
      padding: 1rem;
      background: linear-gradient(135deg,#151922,#0f1117);
      font-size: 0.86rem;
    }
    .voucher-code-box {
      margin-top: 0.8rem;
      padding: 0.9rem;
      border-radius: 0.6rem;
      border: 1px dashed rgba(255,255,255,0.3);
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      text-align: center;
      letter-spacing: 0.18em;
      font-size: 0.9rem;
      background:#050608;
    }
    .voucher-status {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: rgba(245,245,245,0.86);
    }
    .voucher-status span.used { color: #f39c12; }

    .input-row {
      margin-top: 0.8rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }
    .input-row input {
      flex: 1;
      min-width: 160px;
      padding: 0.4rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(255,255,255,0.2);
      background: #10131a;
      color: #f5f5f5;
      font-size: 0.86rem;
    }

    .auth-panel {
      margin-top: 1.2rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(255,255,255,0.18);
      padding: 1rem;
      background: linear-gradient(135deg,#151922,#0f1117);
      font-size: 0.85rem;
    }
    .auth-panel h3 {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }
    .auth-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.6rem;
      align-items: center;
    }
    .auth-row input {
      flex: 1;
      min-width: 150px;
      padding: 0.4rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(255,255,255,0.2);
      background: #10131a;
      color: #f5f5f5;
      font-size: 0.86rem;
    }
    .auth-note {
      margin-top: 0.5rem;
      font-size: 0.78rem;
      color: rgba(245,245,245,0.8);
    }

    /* Admin */
    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
      margin-bottom: 1.4rem;
    }
    .admin-stat {
      border-radius: 0.9rem;
      border: 1px solid rgba(255,255,255,0.16);
      padding: 0.9rem;
      background: #12151d;
      font-size: 0.85rem;
    }
    .admin-stat .label {
      font-size: 0.78rem;
      color: rgba(245,245,245,0.7);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    .admin-stat .value {
      font-size: 1.4rem;
      margin-top: 0.2rem;
    }
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
    }
    .admin-table th,
    .admin-table td {
      border-bottom: 1px solid rgba(255,255,255,0.12);
      padding: 0.35rem 0.3rem;
      text-align: left;
      vertical-align: top;
    }
    .admin-table th {
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-size: 0.7rem;
      color: rgba(245,245,245,0.75);
    }

    /* QR reader area in vendor portal */
    #qr-reader-container {
      margin-top: 0.9rem;
      border-radius: 0.8rem;
      border: 1px solid rgba(255,255,255,0.2);
      padding: 0.6rem;
      background: #10131a;
    }
    #qr-reader {
      width: 100%;
      max-width: 360px;
      margin: 0.3rem auto 0.2rem;
      min-height: 220px;
    }
    #qr-reader video {
      border-radius: 0.7rem;
    }
    #voucher-qr {
      margin-top: 0.8rem;
      display: flex;
      justify-content: center;
    }

    footer {
      border-top: 1px solid rgba(255,255,255,0.08);
      padding: 1.3rem 0 2rem;
      font-size: 0.78rem;
      color: rgba(245,245,245,0.7);
      margin-top: auto;
      background: linear-gradient(90deg,#10131a,#0b0d10);
    }
    .footer-inner {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 0.8rem;
    }

    .hidden { display: none !important; }

    @media (max-width: 900px) {
      .hero-inner,
      .two-col,
      .grid-3 {
        grid-template-columns: 1fr;
      }
      .hero { padding-top: 2.3rem; }
      .nav-links { display: none; }
      .nav-cta { gap: 0.4rem; }
      .nav-user { display: none; }
      #qr-reader {
        max-width: 100%;
      }
      .service-strip {
        margin-top: 1.1rem;
      }
    }
    @media (max-width: 600px) {
      .container { padding: 0 1.1rem; }
      .hero-inner { gap: 1.8rem; }
      .hero-title { font-size: 1.8rem; }
    }
  </style>
</head>
<body>
  <div class="page-root">
    <!-- HEADER -->
    <header>
      <div class="container navbar">
        <div class="nav-left">
          <div class="logo-icon">WTF</div>
          <div class="logo-text">
            <span>WHISKEY ¬∑ TOBACCO ¬∑ FIREARMS</span>
            <span>MEMBERS CLUB</span>
          </div>
        </div>
        <nav class="nav-links">
          <button type="button" data-view="home" class="active">Home</button>
          <button type="button" data-view="member">Member</button>
          <button type="button" data-view="vendor">Vendor</button>
          <button type="button" data-view="admin" id="nav-admin" style="display:none;">Admin</button>
        </nav>
        <div class="nav-cta">
          <div id="nav-user" class="nav-user"></div>
          <button class="btn btn-outline" type="button" data-view="member">Member</button>
          <button class="btn btn-primary" type="button" data-view="vendor">Partner</button>
        </div>
      </div>
    </header>

    <main>
      <!-- HOME VIEW -->
      <div id="view-home" class="view view-active">
        <section class="hero">
          <div class="container hero-inner">
            <div>
              <div class="eyebrow">Private membership ¬∑ licensed partners only</div>
              <h1 class="hero-title">
                Exclusive access to <span class="highlight">cigars, whiskey, and firearms training</span> from trusted businesses.
              </h1>
              <p class="hero-text">
                Whiskey Tobacco Firearms (WTF) is a Veteran-Owned members club that connects discerning adults
                with vetted cigar lounges, whiskey bars, shooting ranges, and certified firearms instructors.
                We proudly support veterans, first responders, and healthcare workers ‚Äî starting as a small
                local business in Miami with the goal of growing into a nationwide network.
              </p>
              <div class="hero-actions">
                <button class="btn btn-primary" type="button" data-view="member">Become a member</button>
                <button class="btn btn-outline" type="button" data-view="vendor">Apply as a licensed partner</button>
              </div>
              <p class="hero-note">
                <strong>No private sales.</strong> WTF does not broker firearm transfers, person-to-person
                deals, or online alcohol sales. All offers are redeemed directly with licensed businesses
                that follow federal, state, and local laws.
              </p>

              <!-- patriotic + service row -->
              <div class="service-strip">
                <div class="service-pill">
                  <span class="emoji">üá∫üá∏</span>
                  Veteran-Owned
                </div>
                <div class="service-pill">
                  <span class="emoji">ü™ñ</span>
                  Proud USMC background
                </div>
                <div class="service-pill">
                  <span class="emoji">üöí</span>
                  Supports Fire &amp; Rescue
                </div>
                <div class="service-pill">
                  <span class="emoji">üöì</span>
                  Supports Law Enforcement
                </div>
                <div class="service-pill">
                  <span class="emoji">‚öïÔ∏è</span>
                  Supports Healthcare Workers
                </div>
              </div>
            </div>

            <aside class="hero-card">
              <h2>How WTF works</h2>
              <div class="pill-row">
                <div class="pill">Subscribe</div>
                <div class="pill">Discover</div>
                <div class="pill">Scan &amp; Save</div>
              </div>
              <ul>
                <li>
                  <span class="bullet">‚Ä¢</span>
                  <span><strong>Members</strong> join on a monthly or yearly plan to access in-person discounts.</span>
                </li>
                <li>
                  <span class="bullet">‚Ä¢</span>
                  <span><strong>Licensed businesses</strong> publish offers (no private sellers).</span>
                </li>
                <li>
                  <span class="bullet">‚Ä¢</span>
                  <span>Members generate a <strong>one-time voucher code</strong> and QR on their phone.</span>
                </li>
                <li>
                  <span class="bullet">‚Ä¢</span>
                  <span>Vendors scan the QR with their phone and mark the code used ‚Äî no extra hardware.</span>
                </li>
              </ul>
              <div class="hero-card-footer">
                All vouchers are stored in Supabase and enforced as single-use.
                You, your partners, and your members share one source of truth for redemptions.
              </div>
            </aside>
          </div>
        </section>

        <!-- About / mission block with full description -->
        <section class="section">
          <div class="container">
            <h3 class="section-title">About Whiskey Tobacco Firearms (WTF)</h3>
            <p class="section-subtitle">
              Whiskey Tobacco Firearms (WTF) is a Veteran-Owned membership program offering exclusive
              savings on cigars, bourbon, whiskey, firearms, accessories, training courses, and shooting
              ranges. Our mission is to connect members with high-quality brands, experiences, and
              opportunities in cigars, spirits, and firearms ‚Äî all while delivering real savings on the
              things they are already passionate about.
            </p>
            <p class="section-subtitle">
              While the long-term goal is to build a nationwide network of respected lounges, ranges,
              and instructors, WTF is currently a small local business based in South Florida. Every new
              partner is vetted for licensing and legitimacy, and we proudly support veterans, first
              responders, and healthcare workers through both our partnerships and the way we do business.
            </p>
          </div>
        </section>

        <section class="section">
          <div class="container">
            <h3 class="section-title">How it works</h3>
            <div class="grid-3">
              <div class="card">
                <h4>1. Join as a WTF member</h4>
                <p>Sign up with email or Google. Membership levels will be added later.</p>
                <small>Members must follow all local, state, and federal regulations.</small>
              </div>
              <div class="card">
                <h4>2. Discover trusted partners</h4>
                <p>Browse cigar lounges, whiskey venues, ranges, and instructors as the directory grows into a full map and search experience.</p>
              </div>
              <div class="card">
                <h4>3. Generate &amp; scan QR vouchers</h4>
                <p>Members show a QR code at checkout. Vendors scan with their own phone and mark the code used ‚Äî simple and trackable.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- BROWSE OFFERS SECTION -->
        <section class="section">
          <div class="container">
            <h3 class="section-title">Current partner offers</h3>
            <p class="section-subtitle">
              These offers are loaded directly from the WTF vendor database. Each one is tied
              to a licensed business. Members generate single-use vouchers from the Member area
              using the matching voucher label.
            </p>
            <div id="offers-list" class="offers-list">
              <!-- Filled dynamically from Supabase -->
            </div>
          </div>
        </section>

        <!-- VENDORS DIRECTORY SECTION -->
        <section class="section">
          <div class="container">
            <h3 class="section-title">Find a WTF partner</h3>
            <p class="section-subtitle">
              This directory lists active partner businesses from the WTF database. Filters are simple
              for now; in a later phase this becomes a map/search experience with distance by location.
            </p>
            <div class="vendor-filters">
              <span>Filter:</span>
              <select id="vendor-filter-category">
                <option value="">All categories</option>
              </select>
              <select id="vendor-filter-state">
                <option value="">All states</option>
              </select>
              <button class="btn btn-outline" id="vendor-filter-reset" type="button">
                Reset filters
              </button>
            </div>
            <div id="vendors-list" class="vendors-grid">
              <!-- Filled dynamically from Supabase -->
            </div>
          </div>
        </section>

        <section class="section">
          <div class="container">
            <h3 class="section-title">For licensed partners &amp; legal safety</h3>
            <div class="two-col">
              <div>
                <p><strong>WTF is built for legitimate businesses.</strong></p>
                <p>
                  Cigar lounges, whiskey venues, ranges, certified instructors, and licensed firearms
                  retailers can promote in-person offers to verified members. All firearm-related ads
                  must come from licensed FFLs or ranges ‚Äì never from private individuals.
                </p>
                <ul>
                  <li>List locations, hours, and categories.</li>
                  <li>Create trackable, one-time vouchers with your own rules.</li>
                  <li>Check member codes at checkout and mark them used.</li>
                  <li>Review basic redemption analytics.</li>
                </ul>
              </div>
              <div class="policy-box">
                <p><strong>Prohibited on WTF:</strong></p>
                <ul>
                  <li>Private firearm listings, trades, or ‚Äúmeet-up‚Äù deals.</li>
                  <li>Sharing contact info to arrange off-platform sales.</li>
                  <li>Any attempt to bypass background checks or legal transfer processes.</li>
                </ul>
                <p style="margin-top:0.6rem;">
                  Reviews and comments (when added) may be removed if they appear to encourage illegal
                  activity. Repeat violations can result in account or partner removal.
                </p>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- MEMBER VIEW -->
      <div id="view-member" class="view">
        <section class="sub-hero">
          <div class="container">
            <h1>Member area</h1>
            <p>
              Sign in or create an account using email or Google. Once signed in,
              you can generate single-use voucher codes and QR codes tied to real partner offers.
            </p>
          </div>
        </section>

        <section class="sub-content">
          <div class="container">
            <!-- AUTH PANEL -->
            <div class="auth-panel" id="auth-logged-out">
              <h3>Sign in or create an account</h3>
              <div class="auth-row">
                <input id="auth-email" type="email" placeholder="Email address" />
                <input id="auth-password" type="password" placeholder="Password" />
              </div>
              <div class="auth-row" style="margin-top:0.6rem;">
                <button class="btn btn-primary" id="btn-email-login" type="button">
                  Email sign in / sign up
                </button>
                <button class="btn btn-outline" id="btn-google" type="button">
                  Continue with Google
                </button>
              </div>
              <div class="auth-note" id="auth-message"></div>
            </div>

            <div class="auth-panel hidden" id="auth-logged-in">
              <h3>Signed in</h3>
              <div class="auth-note">
                Logged in as <strong><span id="auth-user-email"></span></strong>.
              </div>
              <div class="auth-row" style="margin-top:0.8rem;">
                <button class="btn btn-outline" id="btn-signout" type="button">
                  Sign out
                </button>
              </div>
            </div>

            <!-- MEMBER CONTENT: ONLY WHEN LOGGED IN -->
            <div id="member-content" class="hidden">
              <h3 class="section-title" style="margin-top:2rem;">Generate a voucher</h3>
              <div class="voucher-panel">
                <p>
                  1. Select a voucher label.  
                  2. Click ‚ÄúGenerate voucher‚Äù.  
                  3. Show the QR code and code to a licensed partner at checkout.
                </p>

                <div style="margin-top:0.8rem;">
                  <label for="offer-select" style="font-size:0.86rem;">Voucher label:</label>
                  <select id="offer-select" style="margin-left:0.4rem; padding:0.3rem 0.4rem; border-radius:0.4rem; border:1px solid rgba(255,255,255,0.25); background:#10131a; color:#f5f5f5; font-size:0.86rem;">
                    <option value="CIGAR10">CIGAR10</option>
                    <option value="WHISKEY5">WHISKEY5</option>
                    <option value="TRAINING15">TRAINING15</option>
                  </select>
                  <span style="font-size:0.78rem; color:rgba(245,245,245,0.7); margin-left:0.4rem;">
                    (match labels shown in the offers list)
                  </span>
                </div>

                <div style="margin-top:0.8rem;">
                  <button class="btn btn-primary" id="btn-generate" type="button">Generate voucher</button>
                </div>

                <div id="voucher-display" style="display:none;">
                  <div class="voucher-code-box" id="voucher-code-box"></div>
                  <div id="voucher-qr"></div>
                  <div class="voucher-status" id="voucher-status"></div>
                </div>
              </div>
              <p class="auth-note" style="margin-top:1rem;">
                Every voucher is stored with your email in the WTF database. Vendors scan your QR once and the code cannot be reused.
              </p>
            </div>
          </div>
        </section>
      </div>

      <!-- VENDOR VIEW -->
      <div id="view-vendor" class="view">
        <section class="sub-hero">
          <div class="container">
            <h1>Vendor / partner area</h1>
            <p>
              Partners use this portal to redeem member vouchers at the counter.  
              Log in with your approved vendor email address. If you‚Äôre not yet a vendor, you can still
              read the rules but won‚Äôt see the redeem tools.
            </p>
          </div>
        </section>

        <section class="sub-content">
          <div class="container">
            <div id="vendor-locked" class="voucher-panel">
              <p>
                To access the vendor portal, sign in using the email that WTF has approved for your
                business. Once your account is flagged as a vendor, you‚Äôll see the voucher tools and
                basic redemption history here.
              </p>
              <p class="auth-note" style="margin-top:0.6rem;">
                You can sign in on the <strong>Member</strong> page using the same vendor email ‚Äì the system
                will recognize you as both a member and a vendor if configured that way.
              </p>
            </div>

            <div id="vendor-portal" class="hidden">
              <h3 class="section-title">Redeem a voucher</h3>
              <div class="voucher-panel">
                <p>
                  Members will show you a QR code and a voucher code on their phone.  
                  You can either type the code or tap <strong>Scan QR code</strong> and
                  use your phone‚Äôs camera to read it.
                </p>

                <div class="input-row" style="margin-top:1rem;">
                  <input id="vendor-code-input" type="text" placeholder="Enter or scan voucher code" />
                  <button class="btn btn-primary" id="btn-redeem" type="button">
                    Mark as redeemed
                  </button>
                </div>

                <div class="input-row" style="margin-top:0.6rem;">
                  <button class="btn btn-outline" id="btn-start-scan" type="button">
                    Scan QR code
                  </button>
                  <button class="btn btn-outline hidden" id="btn-stop-scan" type="button">
                    Stop scanning
                  </button>
                </div>

                <div id="qr-reader-container" class="hidden">
                  <div style="font-size:0.78rem; color:rgba(245,245,245,0.75); margin-bottom:0.3rem;">
                    Point your camera at the customer‚Äôs QR code. When it reads successfully,
                    the code will appear above and you can tap ‚ÄúMark as redeemed‚Äù.
                  </div>
                  <div id="qr-reader"></div>
                </div>

                <div class="voucher-status" id="vendor-status" style="margin-top:0.8rem;"></div>

                <p style="margin-top:1rem; font-size:0.8rem; color:rgba(245,245,245,0.75);">
                  Once a code is redeemed, it cannot be used again. Screenshots and copies will fail at the counter.
                </p>
              </div>

              <section class="section" style="border-top:none; padding-top:2rem;">
                <h3 class="section-title">Recent redemptions (this vendor)</h3>
                <div class="voucher-panel">
                  <div id="vendor-redeem-list" style="font-size:0.8rem; color:rgba(245,245,245,0.85);">
                    Loading‚Ä¶
                  </div>
                </div>
              </section>
            </div>

            <section class="section" style="border-top:none; padding-top:2rem;">
              <h3 class="section-title">Partner rules (summary)</h3>
              <div class="two-col">
                <div>
                  <ul>
                    <li>Only licensed businesses can advertise firearms-related services or accessories.</li>
                    <li>No private or person-to-person firearm sales are allowed on WTF.</li>
                    <li>All alcohol and firearms offers must follow applicable laws and age restrictions.</li>
                  </ul>
                </div>
                <div class="policy-box">
                  <strong>Important:</strong>
                  <p style="margin-top:0.4rem;">
                    WTF is a membership and marketing platform only. It does not sell firearms, ammunition,
                    or alcohol and does not broker transfers or private sales between individuals.
                  </p>
                </div>
              </div>
            </section>
          </div>
        </section>
      </div>

      <!-- ADMIN VIEW -->
      <div id="view-admin" class="view">
        <section class="sub-hero">
          <div class="container">
            <h1>Admin dashboard</h1>
            <p>
              Internal WTF view. Shows voucher counts and recent activity. Only users listed in the
              <code>admin_users</code> table can see this page.
            </p>
          </div>
        </section>

        <section class="sub-content">
          <div class="container">
            <div id="admin-locked" class="voucher-panel">
              <p>
                You must be an admin to view this dashboard. If this is your account, add your email
                to the <code>admin_users</code> table in Supabase and refresh.
              </p>
            </div>

            <div id="admin-panel" class="hidden">
              <h3 class="section-title">Voucher stats</h3>
              <div class="admin-grid">
                <div class="admin-stat">
                  <div class="label">Total vouchers</div>
                  <div class="value" id="stat-total">‚Äì</div>
                </div>
                <div class="admin-stat">
                  <div class="label">Active (not redeemed)</div>
                  <div class="value" id="stat-active">‚Äì</div>
                </div>
                <div class="admin-stat">
                  <div class="label">Redeemed</div>
                  <div class="value" id="stat-redeemed">‚Äì</div>
                </div>
              </div>

              <h3 class="section-title">Recent vouchers</h3>
              <div class="voucher-panel">
                <div style="font-size:0.78rem; margin-bottom:0.4rem;">
                  Latest 50 vouchers from any member or vendor.
                </div>
                <div style="overflow-x:auto;">
                  <table class="admin-table">
                    <thead>
                      <tr>
                        <th>Code</th>
                        <th>Offer</th>
                        <th>Member</th>
                        <th>Status</th>
                        <th>Vendor</th>
                        <th>Issued</th>
                        <th>Redeemed</th>
                      </tr>
                    </thead>
                    <tbody id="admin-voucher-rows">
                      <tr><td colspan="7">Loading‚Ä¶</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer>
      <div class="container footer-inner">
        <div>¬© <span id="year"></span> Whiskey Tobacco Firearms, LLC. All rights reserved.</div>
        <div>WTF does not facilitate private sales of firearms or alcohol.</div>
      </div>
    </footer>
  </div>

  <!-- QR code generator & scanner libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.10/html5-qrcode.min.js"></script>

  <!-- Supabase + app logic (unchanged from your previous version) -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const SUPABASE_URL = "https://ztospksseftjupuuwtoa.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0b3Nwa3NzZWZ0anVwdXV3dG9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0Mzg0MTYsImV4cCI6MjA4MDAxNDQxNn0.Dvec8LfAUliX06yLs69PCQwMjjTWPYKnYuNBJn3t20U";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Role flags
    let currentUserEmail = null;
    let isVendor = false;
    let isAdmin = false;
    let currentVendorId = null;

    // QR scan state
    let html5QrCode = null;
    let isScanning = false;

    // DOM refs
    const offersListEl = document.getElementById("offers-list");
    const vendorsListEl = document.getElementById("vendors-list");
    const vendorFilterCategory = document.getElementById("vendor-filter-category");
    const vendorFilterState = document.getElementById("vendor-filter-state");
    const vendorFilterReset = document.getElementById("vendor-filter-reset");

    const vendorLocked = document.getElementById("vendor-locked");
    const vendorPortal = document.getElementById("vendor-portal");
    const vendorRedeemList = document.getElementById("vendor-redeem-list");

    const adminLocked = document.getElementById("admin-locked");
    const adminPanel = document.getElementById("admin-panel");
    const adminNavButton = document.getElementById("nav-admin");

    const statTotal = document.getElementById("stat-total");
    const statActive = document.getElementById("stat-active");
    const statRedeemed = document.getElementById("stat-redeemed");
    const adminVoucherRows = document.getElementById("admin-voucher-rows");

    // Footer year
    document.getElementById("year").textContent = new Date().getFullYear();

    // ---------- HOME: OFFERS ----------
    async function loadOffers() {
      if (!offersListEl) return;

      offersListEl.textContent = "Loading current offers‚Ä¶";

      const { data: offers, error: offersError } = await supabase
        .from("offers")
        .select("*")
        .eq("is_active", true)
        .order("created_at", { ascending: false });

      if (offersError) {
        console.error("Error loading offers:", offersError);
        offersListEl.textContent = "Could not load offers right now.";
        return;
      }

      if (!offers || offers.length === 0) {
        offersListEl.textContent = "No active offers yet. Check back soon.";
        return;
      }

      const vendorIds = [...new Set(offers.map((o) => o.vendor_id).filter(Boolean))];

      let vendorsById = {};
      if (vendorIds.length > 0) {
        const { data: vendors, error: vendorsError } = await supabase
          .from("vendors")
          .select("*")
          .in("id", vendorIds);

        if (!vendorsError && vendors) {
          vendorsById = Object.fromEntries(vendors.map((v) => [v.id, v]));
        }
      }

      offersListEl.innerHTML = "";

      for (const offer of offers) {
        const vendor = vendorsById[offer.vendor_id];
        const vendorName = vendor ? vendor.name : "Partner business";
        const locationText = vendor
          ? [vendor.city, vendor.state].filter(Boolean).join(", ")
          : "";

        const card = document.createElement("div");
        card.className = "card";

        const discountText =
          offer.discount_type === "percent"
            ? `${offer.discount_value}% off`
            : `$${offer.discount_value} off`;

        const validText = offer.valid_until
          ? ` ¬∑ Valid through ${new Date(offer.valid_until).toLocaleDateString()}`
          : "";

        card.innerHTML = `
          <div class="offer-card-header">
            <div>
              <h4>${offer.title}</h4>
              <div class="offer-vendor">${vendorName}${locationText ? " ¬∑ " + locationText : ""}</div>
            </div>
            <div class="offer-badge">${discountText}</div>
          </div>
          <p>${offer.description || ""}</p>
          <div class="offer-footer">
            Voucher label: <strong>${offer.code_label}</strong>${validText}
          </div>
        `;

        offersListEl.appendChild(card);
      }
    }

    // ---------- HOME: VENDORS DIRECTORY ----------
    async function loadVendors() {
      if (!vendorsListEl) return;

      vendorsListEl.textContent = "Loading partner businesses‚Ä¶";

      const { data: vendors, error } = await supabase
        .from("vendors")
        .select("*")
        .eq("is_active", true)
        .order("created_at", { ascending: false });

      if (error) {
        console.error("Error loading vendors:", error);
        vendorsListEl.textContent = "Could not load partners right now.";
        return;
      }

      if (!vendors || vendors.length === 0) {
        vendorsListEl.textContent = "No partners added yet.";
        return;
      }

      const categories = [...new Set(vendors.map((v) => v.category).filter(Boolean))].sort();
      const states = [...new Set(vendors.map((v) => v.state).filter(Boolean))].sort();

      if (vendorFilterCategory && vendorFilterCategory.options.length === 1) {
        categories.forEach((cat) => {
          const opt = document.createElement("option");
          opt.value = cat;
          opt.textContent = cat;
          vendorFilterCategory.appendChild(opt);
        });
      }

      if (vendorFilterState && vendorFilterState.options.length === 1) {
        states.forEach((st) => {
          const opt = document.createElement("option");
          opt.value = st;
          opt.textContent = st;
          vendorFilterState.appendChild(opt);
        });
      }

      function renderList() {
        const catVal = vendorFilterCategory ? vendorFilterCategory.value : "";
        const stateVal = vendorFilterState ? vendorFilterState.value : "";

        const filtered = vendors.filter((v) => {
          const catOk = !catVal || v.category === catVal;
          const stateOk = !stateVal || v.state === stateVal;
          return catOk && stateOk;
        });

        vendorsListEl.innerHTML = "";

        if (filtered.length === 0) {
          vendorsListEl.textContent = "No partners match these filters.";
          return;
        }

        filtered.forEach((v) => {
          const card = document.createElement("div");
          card.className = "card";

          const cityState = [v.city, v.state].filter(Boolean).join(", ");
          const categoryLabel = v.category || "partner";

          card.innerHTML = `
            <h4>${v.name}</h4>
            <div class="vendor-meta">
              ${cityState || "Location TBA"}
            </div>
            <div class="vendor-chip-row">
              <span class="vendor-tag">${categoryLabel}</span>
              ${v.country ? `<span class="vendor-tag">${v.country}</span>` : ""}
            </div>
          `;

          vendorsListEl.appendChild(card);
        });
      }

      renderList();

      if (vendorFilterCategory) vendorFilterCategory.onchange = renderList;
      if (vendorFilterState) vendorFilterState.onchange = renderList;
      if (vendorFilterReset) {
        vendorFilterReset.onclick = () => {
          if (vendorFilterCategory) vendorFilterCategory.value = "";
          if (vendorFilterState) vendorFilterState.value = "";
          renderList();
        };
      }
    }

    // ---------- VIEW SWITCHING ----------
    const views = {
      home: document.getElementById("view-home"),
      member: document.getElementById("view-member"),
      vendor: document.getElementById("view-vendor"),
      admin: document.getElementById("view-admin"),
    };
    const navButtons = document.querySelectorAll("[data-view]");

    function switchView(viewName) {
      Object.keys(views).forEach((name) => {
        if (name === viewName) views[name].classList.add("view-active");
        else views[name].classList.remove("view-active");
      });
      document.querySelectorAll(".nav-links button").forEach((btn) => {
        btn.classList.toggle("active", btn.getAttribute("data-view") === viewName);
      });

      if (viewName === "home") {
        loadOffers();
        loadVendors();
      }
      if (viewName === "admin" && isAdmin) {
        loadAdminDashboard();
      }
      if (viewName === "vendor" && isVendor) {
        loadVendorRedemptions();
      }

      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    navButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const v = btn.getAttribute("data-view");
        if (views[v]) switchView(v);
      });
    });

    // ---------- AUTH UI ----------
    const navUser = document.getElementById("nav-user");
    const authLoggedOut = document.getElementById("auth-logged-out");
    const authLoggedIn = document.getElementById("auth-logged-in");
    const authUserEmail = document.getElementById("auth-user-email");
    const authMessage = document.getElementById("auth-message");
    const memberContent = document.getElementById("member-content");

    function setAuthMessage(msg) {
      authMessage.textContent = msg || "";
    }

    async function loadUserRoles(email) {
      isVendor = false;
      isAdmin = false;
      currentVendorId = null;

      if (!email) {
        updateRoleUI();
        return;
      }

      // Check vendor_users
      const { data: vendorRecord, error: vendorError } = await supabase
        .from("vendor_users")
        .select("*")
        .eq("email", email)
        .maybeSingle();

      if (!vendorError && vendorRecord) {
        isVendor = true;
        currentVendorId = vendorRecord.vendor_id || null;
      }

      // Check admin_users
      const { data: adminRecord, error: adminError } = await supabase
        .from("admin_users")
        .select("*")
        .eq("email", email)
        .maybeSingle();

      if (!adminError && adminRecord) {
        isAdmin = true;
      }

      updateRoleUI();
    }

    function updateRoleUI() {
      // Vendor portal visibility
      if (vendorPortal && vendorLocked) {
        if (isVendor || isAdmin) {
          vendorPortal.classList.remove("hidden");
          vendorLocked.classList.add("hidden");
        } else {
          vendorPortal.classList.add("hidden");
          vendorLocked.classList.remove("hidden");
        }
      }

      // Admin nav and panel visibility
      if (adminNavButton && adminLocked && adminPanel) {
        if (isAdmin) {
          adminNavButton.style.display = "inline-block";
          adminLocked.classList.add("hidden");
          adminPanel.classList.remove("hidden");
        } else {
          adminNavButton.style.display = "none";
          adminLocked.classList.remove("hidden");
          adminPanel.classList.add("hidden");
          if (document.getElementById("view-admin").classList.contains("view-active")) {
            switchView("home");
          }
        }
      }
    }

    function updateAuthUI(session) {
      const user = session ? session.user : null;

      if (user) {
        currentUserEmail = user.email || null;
        authLoggedOut.classList.add("hidden");
        authLoggedIn.classList.remove("hidden");
        memberContent.classList.remove("hidden");
        authUserEmail.textContent = currentUserEmail || "(no email)";
        if (navUser) navUser.textContent = currentUserEmail || "";

        loadUserRoles(currentUserEmail);
      } else {
        currentUserEmail = null;
        authLoggedOut.classList.remove("hidden");
        authLoggedIn.classList.add("hidden");
        memberContent.classList.add("hidden");
        authUserEmail.textContent = "";
        if (navUser) navUser.textContent = "";
        isVendor = false;
        isAdmin = false;
        currentVendorId = null;
        updateRoleUI();
      }
    }

    (async () => {
      const { data, error } = await supabase.auth.getSession();
      if (error) console.error("Error getting session:", error);
      updateAuthUI(data?.session || null);
    })();

    supabase.auth.onAuthStateChange((_event, session) => {
      updateAuthUI(session);
    });

    // ---------- AUTH ACTIONS ----------
    const emailInput = document.getElementById("auth-email");
    const passwordInput = document.getElementById("auth-password");
    const btnEmailLogin = document.getElementById("btn-email-login");
    const btnGoogle = document.getElementById("btn-google");
    const btnSignout = document.getElementById("btn-signout");

    if (btnEmailLogin) {
      btnEmailLogin.addEventListener("click", async () => {
        const email = (emailInput.value || "").trim();
        const password = (passwordInput.value || "").trim();

        if (!email || !password) {
          setAuthMessage("Enter email and password.");
          return;
        }

        setAuthMessage("Checking account‚Ä¶");

        let { error } = await supabase.auth.signInWithPassword({ email, password });

        if (error && error.message?.includes("Invalid login credentials")) {
          const { error: signUpError } = await supabase.auth.signUp({ email, password });
          if (signUpError) {
            setAuthMessage("Sign up failed: " + signUpError.message);
          } else {
            setAuthMessage("Sign up successful. Check your email if confirmation is required, then sign in.");
          }
        } else if (error) {
          setAuthMessage("Sign in failed: " + error.message);
        } else {
          setAuthMessage("");
        }
      });
    }

    if (btnGoogle) {
      btnGoogle.addEventListener("click", async () => {
        setAuthMessage("Redirecting to Google‚Ä¶");
        const { error } = await supabase.auth.signInWithOAuth({
          provider: "google",
          options: {
            redirectTo: window.location.origin,
          },
        });
        if (error) setAuthMessage("Google sign-in failed: " + error.message);
      });
    }

    if (btnSignout) {
      btnSignout.addEventListener("click", async () => {
        await supabase.auth.signOut();
        setAuthMessage("");
      });
    }

    // ---------- VOUCHER GENERATION ----------
    let currentVoucherCode = null;
    let currentVoucherLabel = null;

    function createVoucherCode() {
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let out = "";
      for (let i = 0; i < 10; i++) {
        out += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return out;
    }

    const btnGenerate = document.getElementById("btn-generate");
    const voucherDisplay = document.getElementById("voucher-display");
    const voucherBox = document.getElementById("voucher-code-box");
    const voucherStatus = document.getElementById("voucher-status");
    const voucherQrContainer = document.getElementById("voucher-qr");

    function renderVoucherQR(code) {
      if (!voucherQrContainer || typeof QRCode === "undefined") return;
      voucherQrContainer.innerHTML = "";
      new QRCode(voucherQrContainer, {
        text: code,
        width: 160,
        height: 160,
      });
    }

    if (btnGenerate) {
      btnGenerate.addEventListener("click", async () => {
        if (!currentUserEmail) {
          setAuthMessage("You must be signed in to generate a voucher.");
          switchView("member");
          return;
        }

        const offerSelect = document.getElementById("offer-select");
        const offerId = offerSelect ? offerSelect.value : "UNKNOWN";

        const code = createVoucherCode();

        const { data, error } = await supabase
          .from("vouchers")
          .insert({
            code,
            offer_label: offerId,
            member_email: currentUserEmail,
            status: "active",
          })
          .select()
          .single();

        if (error) {
          console.error("Error creating voucher:", error);
          if (voucherStatus) {
            voucherStatus.textContent =
              "There was a problem creating your voucher. Please try again.";
          }
          return;
        }

        currentVoucherCode = data.code;
        currentVoucherLabel = data.offer_label;

        voucherBox.textContent = data.code;
        renderVoucherQR(data.code);
        voucherStatus.innerHTML =
          "Offer label: <strong>" +
          data.offer_label +
          "</strong> ¬∑ Status: <strong>Active (not yet redeemed)</strong><br/>" +
          "Generated for: <strong>" +
          data.member_email +
          "</strong>";
        voucherDisplay.style.display = "block";
      });
    }

    // ---------- VENDOR REDEEM ----------
    const vendorInput = document.getElementById("vendor-code-input");
    const btnRedeem = document.getElementById("btn-redeem");
    const vendorStatus = document.getElementById("vendor-status");
    const vendorScanStart = document.getElementById("btn-start-scan");
    const vendorScanStop = document.getElementById("btn-stop-scan");
    const qrReaderContainer = document.getElementById("qr-reader-container");
    const qrReaderElementId = "qr-reader";

    async function loadVendorRedemptions() {
      if (!vendorRedeemList || !currentVendorId) {
        if (vendorRedeemList) vendorRedeemList.textContent = "No vendor ID linked to this account yet.";
        return;
      }

      const { data, error } = await supabase
        .from("vouchers")
        .select("*")
        .eq("vendor_id", currentVendorId)
        .order("redeemed_at", { ascending: false })
        .limit(20);

      if (error) {
        console.error("Error loading vendor redemptions:", error);
        vendorRedeemList.textContent = "Could not load redemptions.";
        return;
      }

      if (!data || data.length === 0) {
        vendorRedeemList.textContent = "No vouchers redeemed yet for this vendor.";
        return;
      }

      const lines = data.map((v) => {
        const when = v.redeemed_at
          ? new Date(v.redeemed_at).toLocaleString()
          : "‚Äì";
        return `${v.code} ¬∑ ${v.offer_label} ¬∑ ${v.member_email} ¬∑ ${when}`;
      });

      vendorRedeemList.innerHTML = lines.map((l) => `<div>${l}</div>`).join("");
    }

    if (btnRedeem) {
      btnRedeem.addEventListener("click", async () => {
        if (!isVendor && !isAdmin) {
          vendorStatus.textContent = "Only vendor or admin accounts can redeem vouchers.";
          return;
        }

        const entered = (vendorInput.value || "").trim().toUpperCase();
        if (!entered) {
          vendorStatus.textContent = "Please enter a voucher code.";
          return;
        }

        vendorStatus.textContent = "Checking code‚Ä¶";

        const { data: voucher, error } = await supabase
          .from("vouchers")
          .select("*")
          .eq("code", entered)
          .maybeSingle();

        if (error) {
          console.error("Error looking up voucher:", error);
          vendorStatus.textContent =
            "There was a problem checking this code. Please try again.";
          return;
        }

        if (!voucher) {
          vendorStatus.textContent =
            "Code not found. Member may not have generated a valid voucher.";
          return;
        }

        if (voucher.status === "redeemed") {
          vendorStatus.innerHTML =
            "This voucher is already marked as <span class='used'>USED</span> and cannot be redeemed again." +
            (voucher.redeemed_at
              ? " Redeemed at: " + new Date(voucher.redeemed_at).toLocaleString()
              : "");
          return;
        }

        const { data: updated, error: updError } = await supabase
          .from("vouchers")
          .update({
            status: "redeemed",
            redeemed_at: new Date().toISOString(),
            vendor_id: currentVendorId,
          })
          .eq("code", entered)
          .select()
          .single();

        if (updError) {
          console.error("Error redeeming voucher:", updError);
          vendorStatus.textContent =
            "There was a problem marking this code as redeemed. Please try again.";
          return;
        }

        vendorStatus.innerHTML =
          "Voucher <strong>" +
          updated.code +
          "</strong> marked as <span class='used'>USED</span> for <strong>" +
          updated.member_email +
          "</strong>.";

        if (currentVoucherCode && entered === currentVoucherCode && voucherStatus) {
          voucherStatus.innerHTML =
            "Offer label: <strong>" +
            (currentVoucherLabel || updated.offer_label) +
            "</strong> ¬∑ Status: <span class='used'>USED (one-time voucher, now redeemed)</span><br/>" +
            "Generated for: <strong>" +
            updated.member_email +
            "</strong>";
        }

        loadVendorRedemptions();
      });
    }

    // ---------- QR SCANNING (VENDOR) ----------
    function updateScanButtons() {
      if (!vendorScanStart || !vendorScanStop || !qrReaderContainer) return;
      if (isScanning) {
        vendorScanStart.classList.add("hidden");
        vendorScanStop.classList.remove("hidden");
        qrReaderContainer.classList.remove("hidden");
      } else {
        vendorScanStart.classList.remove("hidden");
        vendorScanStop.classList.add("hidden");
        qrReaderContainer.classList.add("hidden");
      }
    }

    async function startQrScan() {
      if (isScanning) return;
      if (typeof Html5Qrcode === "undefined") {
        vendorStatus.textContent = "QR scanning library not loaded.";
        return;
      }

      try {
        html5QrCode = new Html5Qrcode(qrReaderElementId);
      } catch (e) {
        console.error("Error initializing Html5Qrcode:", e);
        vendorStatus.textContent = "Could not start camera. Check browser permissions.";
        return;
      }

      const config = { fps: 10, qrbox: { width: 220, height: 220 } };

      const onScanSuccess = (decodedText /*, decodedResult */) => {
        // Stop scanning as soon as we read a code
        stopQrScan();
        if (vendorInput) {
          vendorInput.value = decodedText.trim().toUpperCase();
        }
        vendorStatus.textContent = "Scanned code: " + decodedText + ". Now tap ‚ÄúMark as redeemed‚Äù.";
      };

      const onScanError = (_errorMessage) => {
        // ignore noisy scan errors
      };

      try {
        await html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess, onScanError);
        isScanning = true;
        updateScanButtons();
      } catch (err) {
        console.error("Error starting QR scan:", err);
        vendorStatus.textContent = "Could not access camera. Check browser settings.";
        try {
          await html5QrCode.stop();
        } catch (_e) {}
        isScanning = false;
        updateScanButtons();
      }
    }

    async function stopQrScan() {
      if (!html5QrCode) {
        isScanning = false;
        updateScanButtons();
        return;
      }
      try {
        await html5QrCode.stop();
      } catch (e) {
        console.error("Error stopping QR scan:", e);
      }
      try {
        await html5QrCode.clear();
      } catch (_e) {}
      html5QrCode = null;
      isScanning = false;
      updateScanButtons();
    }

    if (vendorScanStart) {
      vendorScanStart.addEventListener("click", () => {
        vendorStatus.textContent = "";
        startQrScan();
      });
    }

    if (vendorScanStop) {
      vendorScanStop.addEventListener("click", () => {
        stopQrScan();
      });
    }

    // ---------- ADMIN DASHBOARD ----------
    async function loadAdminDashboard() {
      if (!isAdmin) return;

      const { data: vouchers, error } = await supabase
        .from("vouchers")
        .select("*")
        .order("created_at", { ascending: false })
        .limit(50);

      if (error) {
        console.error("Error loading vouchers:", error);
        adminVoucherRows.innerHTML = "<tr><td colspan='7'>Could not load vouchers.</td></tr>";
        return;
      }

      const total = vouchers.length;
      const redeemed = vouchers.filter((v) => v.status === "redeemed").length;
      const active = vouchers.filter((v) => v.status !== "redeemed").length;

      statTotal.textContent = total.toString();
      statActive.textContent = active.toString();
      statRedeemed.textContent = redeemed.toString();

      if (vouchers.length === 0) {
        adminVoucherRows.innerHTML = "<tr><td colspan='7'>No vouchers yet.</td></tr>";
        return;
      }

      const vendorIds = [...new Set(vouchers.map((v) => v.vendor_id).filter(Boolean))];
      let vendorsById = {};
      if (vendorIds.length > 0) {
        const { data: vendors, error: vendorsErr } = await supabase
          .from("vendors")
          .select("*")
          .in("id", vendorIds);
        if (!vendorsErr && vendors) {
          vendorsById = Object.fromEntries(vendors.map((v) => [v.id, v]));
        }
      }

      adminVoucherRows.innerHTML = vouchers
        .map((v) => {
          const issued = v.created_at ? new Date(v.created_at).toLocaleString() : "‚Äì";
          const redeemedAt = v.redeemed_at ? new Date(v.redeemed_at).toLocaleString() : "‚Äì";
          const vendorName = v.vendor_id && vendorsById[v.vendor_id]
            ? vendorsById[v.vendor_id].name
            : "";
          return `
            <tr>
              <td>${v.code}</td>
              <td>${v.offer_label || ""}</td>
              <td>${v.member_email || ""}</td>
              <td>${v.status || ""}</td>
              <td>${vendorName}</td>
              <td>${issued}</td>
              <td>${redeemedAt}</td>
            </tr>
          `;
        })
        .join("");
    }

    // Initial home data
    loadOffers();
    loadVendors();
  </script>
</body>
</html>
