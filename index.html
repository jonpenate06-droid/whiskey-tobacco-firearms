<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Whiskey Tobacco Firearms (WTF)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Whiskey Tobacco Firearms (WTF) – private membership club for cigars, whiskey and firearms-related training from licensed businesses only. No private sellers."
  />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #050608;
      color: #f5f5f5;
      line-height: 1.6;
    }
    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; }

    .page-root { min-height: 100vh; display: flex; flex-direction: column; }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 1.5rem; }

    header {
      border-bottom: 1px solid rgba(255,255,255,0.08);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(12px);
      background: rgba(5,6,8,0.9);
    }
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 0;
    }
    .nav-left {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }
    .logo-icon {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: 2px solid #c58b3a;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.9rem;
      letter-spacing: 0.08em;
      background: radial-gradient(circle at 20% 0%, #222, #050608);
    }
    .logo-text {
      display: flex;
      flex-direction: column;
      font-size: 0.8rem;
      text-transform: uppercase;
    }
    .logo-text span:first-child {
      font-weight: 600;
      letter-spacing: 0.12em;
    }
    .logo-text span:last-child {
      font-size: 0.7rem;
      opacity: 0.7;
      letter-spacing: 0.12em;
    }

    .nav-links {
      display: flex;
      gap: 1.2rem;
      font-size: 0.88rem;
    }
    .nav-links button {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      opacity: 0.8;
    }
    .nav-links button:hover { opacity: 1; }
    .nav-links button.active {
      opacity: 1;
      border-bottom: 2px solid #c58b3a;
      padding-bottom: 0.1rem;
    }

    .nav-cta {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }
    .nav-user {
      font-size: 0.78rem;
      color: rgba(245,245,245,0.7);
      max-width: 160px;
      text-align: right;
    }

    .btn {
      border-radius: 999px;
      padding: 0.5rem 1.1rem;
      font-size: 0.9rem;
      border: 1px solid transparent;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      white-space: nowrap;
    }
    .btn-outline {
      border-color: rgba(255,255,255,0.3);
      background: transparent;
      color: #f5f5f5;
    }
    .btn-primary {
      border-color: #c58b3a;
      background: linear-gradient(120deg, #c58b3a, #8c5a19);
      color: #050608;
      font-weight: 600;
    }
    .btn-outline:hover { border-color: #c58b3a; }
    .btn-primary:hover { filter: brightness(1.05); }

    .hero { padding: 3rem 0 2.4rem; }
    .hero-inner {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 2.4rem;
      align-items: center;
    }
    .eyebrow {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #c58b3a;
      margin-bottom: 0.4rem;
    }
    .hero-title {
      font-size: clamp(2rem, 3vw, 2.6rem);
      margin-bottom: 0.9rem;
    }
    .hero-text {
      font-size: 0.98rem;
      max-width: 32rem;
      color: rgba(245,245,245,0.86);
      margin-bottom: 1.4rem;
    }
    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-bottom: 1rem;
    }
    .hero-note {
      font-size: 0.78rem;
      color: rgba(245,245,245,0.7);
      max-width: 32rem;
    }
    .hero-note strong { color: #f8e3c0; }

    .hero-card {
      border-radius: 1.1rem;
      padding: 1.6rem;
      border: 1px solid rgba(255,255,255,0.12);
      background:
        radial-gradient(circle at 0 0, rgba(197,139,58,0.15), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(52,143,191,0.25), transparent 55%),
        #07080b;
      box-shadow: 0 18px 45px rgba(0,0,0,0.5);
      font-size: 0.85rem;
    }
    .hero-card h2 {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 0.8rem;
      opacity: 0.9;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
      margin-bottom: 0.9rem;
    }
    .pill {
      border-radius: 999px;
      padding: 0.28rem 0.7rem;
      font-size: 0.7rem;
      background: rgba(5,6,8,0.85);
      border: 1px solid rgba(255,255,255,0.16);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.9;
    }
    .hero-card ul { list-style: none; margin: 0.4rem 0 0.9rem; padding: 0; }
    .hero-card li {
      margin-bottom: 0.4rem;
      display: flex;
      gap: 0.4rem;
      align-items: flex-start;
    }
    .hero-card li span.bullet {
      font-size: 0.9rem;
      color: #c58b3a;
      margin-top: 0.05rem;
    }
    .hero-card-footer {
      font-size: 0.72rem;
      color: rgba(245,245,245,0.75);
      border-top: 1px dashed rgba(255,255,255,0.2);
      padding-top: 0.7rem;
    }

    section.section {
      padding: 2.4rem 0;
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    .section-title {
      font-size: 1.05rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      margin-bottom: 1.4rem;
      color: rgba(245,245,245,0.9);
    }
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1.4rem;
    }
    .card {
      border-radius: 1rem;
      padding: 1.1rem;
      border: 1px solid rgba(255,255,255,0.12);
      background: radial-gradient(circle at 0 0, rgba(197,139,58,0.12), transparent 55%),
                  #050608;
      font-size: 0.86rem;
    }
    .card h4 { font-size: 0.9rem; margin-bottom: 0.4rem; }
    .card p {
      font-size: 0.83rem;
      color: rgba(245,245,245,0.82);
    }
    .card small {
      display: block;
      margin-top: 0.4rem;
      font-size: 0.74rem;
      color: rgba(245,245,245,0.7);
    }

    .two-col {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 2rem;
      align-items: flex-start;
      font-size: 0.86rem;
    }
    .two-col p {
      color: rgba(245,245,245,0.85);
      margin-bottom: 0.7rem;
    }
    .two-col ul { padding-left: 1rem; margin-top: 0.5rem; }
    .two-col li { margin-bottom: 0.4rem; }
    .policy-box {
      border-radius: 0.9rem;
      border: 1px solid rgba(255,255,255,0.16);
      padding: 1rem;
      background: #050608;
      font-size: 0.8rem;
    }
    .policy-box strong { color: #f8e3c0; }

    .view { display: none; }
    .view-active { display: block; }

    .sub-hero { padding: 2.5rem 0 1.2rem; }
    .sub-hero h1 { font-size: 1.8rem; margin-bottom: 0.4rem; }
    .sub-hero p {
      max-width: 40rem;
      color: rgba(245,245,245,0.85);
    }

    .sub-content { padding-bottom: 2.5rem; }

    .voucher-panel {
      margin-top: 1.4rem;
      border-radius: 1rem;
      border: 1px solid rgba(255,255,255,0.18);
      padding: 1rem;
      background: #050608;
      font-size: 0.86rem;
    }
    .voucher-code-box {
      margin-top: 0.8rem;
      padding: 0.9rem;
      border-radius: 0.6rem;
      border: 1px dashed rgba(255,255,255,0.3);
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      text-align: center;
      letter-spacing: 0.18em;
      font-size: 0.9rem;
    }
    .voucher-status {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: rgba(245,245,245,0.8);
    }
    .voucher-status span.used { color: #f39c12; }

    .input-row {
      margin-top: 0.8rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }
    .input-row input {
      flex: 1;
      min-width: 160px;
      padding: 0.4rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(255,255,255,0.2);
      background: #050608;
      color: #f5f5f5;
      font-size: 0.86rem;
    }

    .auth-panel {
      margin-top: 1.2rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(255,255,255,0.18);
      padding: 1rem;
      background: #050608;
      font-size: 0.85rem;
    }
    .auth-panel h3 {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }
    .auth-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.6rem;
      align-items: center;
    }
    .auth-row input {
      flex: 1;
      min-width: 150px;
      padding: 0.4rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(255,255,255,0.2);
      background: #050608;
      color: #f5f5f5;
      font-size: 0.86rem;
    }
    .auth-note {
      margin-top: 0.5rem;
      font-size: 0.78rem;
      color: rgba(245,245,245,0.75);
    }

    footer {
      border-top: 1px solid rgba(255,255,255,0.08);
      padding: 1.3rem 0 2rem;
      font-size: 0.78rem;
      color: rgba(245,245,245,0.7);
      margin-top: auto;
    }
    .footer-inner {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 0.8rem;
    }

    .hidden { display: none !important; }

    @media (max-width: 900px) {
      .hero-inner,
      .two-col,
      .grid-3 {
        grid-template-columns: 1fr;
      }
      .hero { padding-top: 2.3rem; }
      .nav-links { display: none; }
      .nav-cta { gap: 0.4rem; }
      .nav-user { display: none; }
    }
    @media (max-width: 600px) {
      .container { padding: 0 1.1rem; }
      .hero-inner { gap: 1.8rem; }
      .hero-title { font-size: 1.8rem; }
    }
  </style>
</head>
<body>
  <div class="page-root">
    <!-- HEADER -->
    <header>
      <div class="container navbar">
        <div class="nav-left">
          <div class="logo-icon">WTF</div>
          <div class="logo-text">
            <span>WHISKEY · TOBACCO · FIREARMS</span>
            <span>MEMBERS CLUB</span>
          </div>
        </div>
        <nav class="nav-links">
          <button type="button" data-view="home" class="active">Home</button>
          <button type="button" data-view="member">Member</button>
          <button type="button" data-view="vendor">Vendor</button>
        </nav>
        <div class="nav-cta">
          <div id="nav-user" class="nav-user"></div>
          <button class="btn btn-outline" type="button" data-view="member">Member</button>
          <button class="btn btn-primary" type="button" data-view="vendor">Partner</button>
        </div>
      </div>
    </header>

    <main>
      <!-- HOME VIEW -->
      <div id="view-home" class="view view-active">
        <section class="hero">
          <div class="container hero-inner">
            <div>
              <div class="eyebrow">Private membership · licensed partners only</div>
              <h1 class="hero-title">
                Exclusive access to cigars, whiskey, and firearms training from trusted businesses.
              </h1>
              <p class="hero-text">
                Whiskey Tobacco Firearms (WTF) connects members with vetted cigar lounges, whiskey bars,
                ranges, and certified firearms trainers. Members unlock in-person discounts using single-use
                codes at legitimate shops only.
              </p>
              <div class="hero-actions">
                <button class="btn btn-primary" type="button" data-view="member">Become a member</button>
                <button class="btn btn-outline" type="button" data-view="vendor">Apply as a licensed partner</button>
              </div>
              <p class="hero-note">
                <strong>No private sales.</strong> WTF does not broker firearm transfers, person-to-person
                deals, or online alcohol sales. All offers are redeemed directly with licensed businesses
                that follow federal, state, and local laws.
              </p>
            </div>
            <aside class="hero-card">
              <h2>How WTF works</h2>
              <div class="pill-row">
                <div class="pill">Subscribe</div>
                <div class="pill">Discover</div>
                <div class="pill">Scan &amp; Save</div>
              </div>
              <ul>
                <li>
                  <span class="bullet">•</span>
                  <span><strong>Members</strong> join on a monthly or yearly plan to access in-person discounts.</span>
                </li>
                <li>
                  <span class="bullet">•</span>
                  <span><strong>Licensed businesses</strong> publish offers (no private sellers).</span>
                </li>
                <li>
                  <span class="bullet">•</span>
                  <span>Members generate a <strong>one-time voucher code</strong> in the app and present it at checkout.</span>
                </li>
                <li>
                  <span class="bullet">•</span>
                  <span>The vendor marks the code as used and applies the discount — screenshots cannot be reused.</span>
                </li>
              </ul>
              <div class="hero-card-footer">
                This page is now wired to Supabase authentication. Next steps:
                connect a real database for vouchers and vendor listings.
              </div>
            </aside>
          </div>
        </section>

        <section class="section">
          <div class="container">
            <h3 class="section-title">How it works</h3>
            <div class="grid-3">
              <div class="card">
                <h4>1. Join as a WTF member</h4>
                <p>Sign up with email or Google. Membership levels will be added later.</p>
                <small>Members must follow all local, state, and federal regulations.</small>
              </div>
              <div class="card">
                <h4>2. Find nearby partners</h4>
                <p>Later we will add a map and search system similar to Yelp or Groupon.</p>
              </div>
              <div class="card">
                <h4>3. Generate one-time vouchers</h4>
                <p>Once the database is connected, vouchers will be stored and marked used once redeemed.</p>
              </div>
            </div>
          </div>
        </section>

        <section class="section">
          <div class="container">
            <h3 class="section-title">For licensed partners &amp; legal safety</h3>
            <div class="two-col">
              <div>
                <p><strong>WTF is built for legitimate businesses.</strong></p>
                <p>
                  Cigar lounges, whiskey venues, ranges, certified instructors, and licensed firearms
                  retailers can promote in-person offers to verified members. All firearm-related ads
                  must come from licensed FFLs or ranges – never from private individuals.
                </p>
                <ul>
                  <li>List locations, hours, and categories.</li>
                  <li>Create trackable, one-time vouchers with your own rules.</li>
                  <li>Check member codes at checkout and mark them used.</li>
                  <li>Review basic redemption analytics.</li>
                </ul>
              </div>
              <div class="policy-box">
                <p><strong>Prohibited on WTF:</strong></p>
                <ul>
                  <li>Private firearm listings, trades, or “meet-up” deals.</li>
                  <li>Sharing contact info to arrange off-platform sales.</li>
                  <li>Any attempt to bypass background checks or legal transfer processes.</li>
                </ul>
                <p style="margin-top:0.6rem;">
                  Reviews and comments (when added) may be removed if they appear to encourage illegal
                  activity. Repeat violations can result in account or partner removal.
                </p>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- MEMBER VIEW -->
      <div id="view-member" class="view">
        <section class="sub-hero">
          <div class="container">
            <h1>Member area</h1>
            <p>
              Sign in or create an account using email or Google. Once signed in,
              you will see demo voucher tools. Later, this area will include maps,
              saved offers, and full voucher history.
            </p>
          </div>
        </section>

        <section class="sub-content">
          <div class="container">
            <!-- AUTH PANEL -->
            <div class="auth-panel" id="auth-logged-out">
              <h3>Sign in or create an account</h3>
              <div class="auth-row">
                <input id="auth-email" type="email" placeholder="Email address" />
                <input id="auth-password" type="password" placeholder="Password" />
              </div>
              <div class="auth-row" style="margin-top:0.6rem;">
                <button class="btn btn-primary" id="btn-email-login" type="button">
                  Email sign in / sign up
                </button>
                <button class="btn btn-outline" id="btn-google" type="button">
                  Continue with Google
                </button>
              </div>
              <div class="auth-note" id="auth-message"></div>
            </div>

            <div class="auth-panel hidden" id="auth-logged-in">
              <h3>Signed in</h3>
              <div class="auth-note">
                Logged in as <strong><span id="auth-user-email"></span></strong>.
              </div>
              <div class="auth-row" style="margin-top:0.8rem;">
                <button class="btn btn-outline" id="btn-signout" type="button">
                  Sign out
                </button>
              </div>
            </div>

            <!-- MEMBER CONTENT: ONLY WHEN LOGGED IN -->
            <div id="member-content" class="hidden">
              <h3 class="section-title" style="margin-top:2rem;">Generate a demo voucher</h3>
              <div class="voucher-panel">
                <p>
                  1. Select an example offer.  
                  2. Click “Generate voucher”.  
                  3. Present the code to a licensed partner at checkout (demo).
                </p>

                <div style="margin-top:0.8rem;">
                  <label for="offer-select" style="font-size:0.86rem;">Example offer:</label>
                  <select id="offer-select" style="margin-left:0.4rem; padding:0.3rem 0.4rem; border-radius:0.4rem; border:1px solid rgba(255,255,255,0.25); background:#050608; color:#f5f5f5; font-size:0.86rem;">
                    <option value="CIGAR10">10% off cigar lounge tab</option>
                    <option value="WHISKEY5">$5 off whiskey flight (dine-in)</option>
                    <option value="TRAINING15">15% off firearms safety class</option>
                  </select>
                </div>

                <div style="margin-top:0.8rem;">
                  <button class="btn btn-primary" id="btn-generate" type="button">Generate voucher</button>
                </div>

                <div id="voucher-display" style="display:none;">
                  <div class="voucher-code-box" id="voucher-code-box"></div>
                  <div class="voucher-status" id="voucher-status"></div>
                </div>
              </div>
              <p class="auth-note" style="margin-top:1rem;">
                In future versions, voucher codes will be stored in Supabase with status
                “unused” or “redeemed” so they can only be used once.
              </p>
            </div>
          </div>
        </section>
      </div>

      <!-- VENDOR VIEW -->
      <div id="view-vendor" class="view">
        <section class="sub-hero">
          <div class="container">
            <h1>Vendor / partner area (demo)</h1>
            <p>
              This shows how a licensed partner might check a member’s code and mark it used.
              In the full system this will require a vendor account and will be backed by
              the database to enforce one-time use.
            </p>
          </div>
        </section>

        <section class="sub-content">
          <div class="container">
            <h3 class="section-title">Demo: check a voucher code</h3>
            <div class="voucher-panel">
              <p>
                In production, you will scan a QR or barcode. Here we just type or paste a code.  
                When you redeem a code here it will be treated as “used” in this browser session.
              </p>

              <div class="input-row">
                <input id="vendor-code-input" type="text" placeholder="Paste voucher code here" />
                <button class="btn btn-primary" id="btn-redeem" type="button">
                  Mark as redeemed (demo)
                </button>
              </div>

              <div class="voucher-status" id="vendor-status" style="margin-top:0.8rem;"></div>

              <p style="margin-top:1rem; font-size:0.8rem; color:rgba(245,245,245,0.75);">
                In the real system, this check will run on the server, tied to a voucher table in Supabase.
                Once a code is marked used, it cannot be redeemed again – even if someone screenshots it.
              </p>
            </div>

            <section class="section" style="border-top:none; padding-top:2rem;">
              <h3 class="section-title">Partner rules (summary)</h3>
              <div class="two-col">
                <div>
                  <ul>
                    <li>Only licensed businesses can advertise firearms-related services or accessories.</li>
                    <li>No private or person-to-person firearm sales are allowed on WTF.</li>
                    <li>All alcohol and firearms offers must follow applicable laws and age restrictions.</li>
                  </ul>
                </div>
                <div class="policy-box">
                  <strong>Important:</strong>
                  <p style="margin-top:0.4rem;">
                    WTF is a membership and marketing platform only. It does not sell firearms, ammunition,
                    or alcohol and does not broker transfers or private sales between individuals.
                  </p>
                </div>
              </div>
            </section>
          </div>
        </section>
      </div>
    </main>

    <footer>
      <div class="container footer-inner">
        <div>© <span id="year"></span> Whiskey Tobacco Firearms, LLC. All rights reserved.</div>
        <div>WTF does not facilitate private sales of firearms or alcohol.</div>
      </div>
    </footer>
  </div>

  <!-- Supabase + app logic -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // Your real Supabase project values
    const SUPABASE_URL = "https://ztospksseftjupuuwtoa.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0b3Nwa3NzZWZ0anVwdXV3dG9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0Mzg0MTYsImV4cCI6MjA4MDAxNDQxNn0.Dvec8LfAUliX06yLs69PCQwMjjTWPYKnYuNBJn3t20U";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Footer year
    document.getElementById("year").textContent = new Date().getFullYear();

    // ----- VIEW SWITCHING -----
    const views = {
      home: document.getElementById("view-home"),
      member: document.getElementById("view-member"),
      vendor: document.getElementById("view-vendor")
    };
    const navButtons = document.querySelectorAll("[data-view]");
    function switchView(viewName) {
      Object.keys(views).forEach((name) => {
        if (name === viewName) views[name].classList.add("view-active");
        else views[name].classList.remove("view-active");
      });
      document.querySelectorAll(".nav-links button").forEach((btn) => {
        btn.classList.toggle("active", btn.getAttribute("data-view") === viewName);
      });
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
    navButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const v = btn.getAttribute("data-view");
        if (views[v]) switchView(v);
      });
    });

    // ----- AUTH UI -----
    const navUser = document.getElementById("nav-user");
    const authLoggedOut = document.getElementById("auth-logged-out");
    const authLoggedIn = document.getElementById("auth-logged-in");
    const authUserEmail = document.getElementById("auth-user-email");
    const authMessage = document.getElementById("auth-message");
    const memberContent = document.getElementById("member-content");

    function setAuthMessage(msg) {
      authMessage.textContent = msg || "";
    }

    function updateAuthUI(session) {
      const user = session ? session.user : null;

      if (user) {
        authLoggedOut.classList.add("hidden");
        authLoggedIn.classList.remove("hidden");
        memberContent.classList.remove("hidden");
        authUserEmail.textContent = user.email || "(no email)";
        if (navUser) navUser.textContent = user.email || "";
      } else {
        authLoggedOut.classList.remove("hidden");
        authLoggedIn.classList.add("hidden");
        memberContent.classList.add("hidden");
        authUserEmail.textContent = "";
        if (navUser) navUser.textContent = "";
      }
    }

    // Initial session
    (async () => {
      const { data } = await supabase.auth.getSession();
      updateAuthUI(data.session || null);
    })();

    // Auth state changes
    supabase.auth.onAuthStateChange((_event, session) => {
      updateAuthUI(session);
    });

    // ----- AUTH ACTIONS -----
    const emailInput = document.getElementById("auth-email");
    const passwordInput = document.getElementById("auth-password");
    const btnEmailLogin = document.getElementById("btn-email-login");
    const btnGoogle = document.getElementById("btn-google");
    const btnSignout = document.getElementById("btn-signout");

    if (btnEmailLogin) {
      btnEmailLogin.addEventListener("click", async () => {
        const email = (emailInput.value || "").trim();
        const password = (passwordInput.value || "").trim();

        if (!email || !password) {
          setAuthMessage("Enter email and password.");
          return;
        }

        setAuthMessage("Checking account…");

        // Try sign-in first
        let { error } = await supabase.auth.signInWithPassword({ email, password });

        if (error && error.message.includes("Invalid login credentials")) {
          // If sign-in fails, attempt sign-up
          const { error: signUpError } = await supabase.auth.signUp({ email, password });
          if (signUpError) {
            setAuthMessage("Sign up failed: " + signUpError.message);
          } else {
            setAuthMessage("Sign up successful. Check your email if confirmation is required, then sign in.");
          }
        } else if (error) {
          setAuthMessage("Sign in failed: " + error.message);
        } else {
          setAuthMessage("");
        }
      });
    }

    if (btnGoogle) {
      btnGoogle.addEventListener("click", async () => {
        setAuthMessage("Redirecting to Google…");
        const { error } = await supabase.auth.signInWithOAuth({
          provider: "google",
          options: {
            redirectTo: window.location.origin
          }
        });
        if (error) setAuthMessage("Google sign-in failed: " + error.message);
      });
    }

    if (btnSignout) {
      btnSignout.addEventListener("click", async () => {
        await supabase.auth.signOut();
        setAuthMessage("");
      });
    }

    // ----- DEMO VOUCHER GENERATION -----
    let currentVoucherCode = null;
    let voucherUsed = false;

    function createVoucherCode() {
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let out = "";
      for (let i = 0; i < 10; i++) {
        out += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return out;
    }

    const btnGenerate = document.getElementById("btn-generate");
    const voucherDisplay = document.getElementById("voucher-display");
    const voucherBox = document.getElementById("voucher-code-box");
    const voucherStatus = document.getElementById("voucher-status");

    if (btnGenerate) {
      btnGenerate.addEventListener("click", () => {
        const offerId = document.getElementById("offer-select").value;
        currentVoucherCode = createVoucherCode();
        voucherUsed = false;

        voucherBox.textContent = currentVoucherCode;
        voucherStatus.innerHTML =
          "Offer: <strong>" + offerId +
          "</strong> · Status: <strong>Active (not yet redeemed)</strong>";
        voucherDisplay.style.display = "block";
      });
    }

    // ----- DEMO REDEEM (VENDOR SIDE) -----
    const vendorInput = document.getElementById("vendor-code-input");
    const btnRedeem = document.getElementById("btn-redeem");
    const vendorStatus = document.getElementById("vendor-status");

    if (btnRedeem) {
      btnRedeem.addEventListener("click", () => {
        const entered = (vendorInput.value || "").trim().toUpperCase();
        if (!entered) {
          vendorStatus.textContent = "Please enter a voucher code.";
          return;
        }
        if (!currentVoucherCode) {
          vendorStatus.textContent =
            "Demo info: No voucher has been generated in this browser yet.";
          return;
        }
        if (entered !== currentVoucherCode) {
          vendorStatus.textContent =
            "Code not recognized in this demo. In production, this would check Supabase.";
          return;
        }
        if (voucherUsed) {
          vendorStatus.innerHTML =
            "This voucher is already marked as <span class='used'>USED</span> (cannot redeem again).";
          return;
        }
        voucherUsed = true;
        vendorStatus.innerHTML =
          "Voucher <strong>" + currentVoucherCode +
          "</strong> marked as <span class='used'>USED</span> (demo only).";
        if (voucherStatus) {
          voucherStatus.innerHTML =
            "Status: <span class='used'>USED (single-use enforced in database in production)</span>";
        }
      });
    }
  </script>
</body>
</html>
